<!DOCTYPE html>

<div data-ng-controller="ProjectEditSenseItAnalysisCtrl">

    <!-- TRANSFORMATIONS -->

    <h2 class="content-subhead">Data processing</h2>

    <ul class="siw-transformations">
        <li data-ng-repeat="variable in transformations.variables">
            <span data-ng-if="txEdit.editable(variable)"><input type="text" data-ng-model="variable.tx.name"/></span>
            <span data-ng-if="!txEdit.editable(variable)">{{variable.label()}}</span>
            <span data-ng-if="variable.editable">
                : {{ variable.txLabel() }} (
                <span data-ng-repeat="(inputvar_index, v) in transformations.inputVariables(variable)">
                    <span data-ng-if="txEdit.editable(variable)">
                        <span data-ng-if="!$first">, </span>
                        <span class="siw-dropdown">
                            <button class="pure-button pure-button-xsmall">{{ v ? v.label() : '?'}}</button>
                            <div class="siw-dropdown-menu pure-menu pure-menu-open">
                                <ul>
                                    <li data-ng-repeat="av in transformations.availableInputVariables(variable, inputvar_index)">
                                        <a href=""
                                           data-ng-click="txEdit.setInputVariable(variable.tx, av.id, inputvar_index)">{{av.label()}}</a>
                                    </li>
                                </ul>
                            </div>
                        </span>
                    </span>
                    <span data-ng-if="!txEdit.editable(variable)">
                        <span data-ng-if="!$first">, </span><span>{{ v ? v.label() : '?'}}</span>
                    </span>
                </span>
            )
            </span>
            <span>: {{variable.outputLabel()}}</span>
            <button data-ng-if="txEdit.editable(variable)" class="pure-button pure-button-primary pure-button-small"
                    data-ng-click="txEdit.deleteVariable(variable)">
                Delete
            </button>
        </li>
    </ul>

    <div data-ng-if="txForm.isOpen()">
        <div class="siw-dropdown">
            <button class="pure-button pure-button-xsmall">Add transformation</button>
            <div class="siw-dropdown-menu pure-menu pure-menu-open">
                <ul>
                    <li data-ng-repeat="(t, label) in availableTransformations">
                        <a href="" data-ng-click="txEdit.createVariable(t)">{{label}}</a>
                    </li>
                </ul>
            </div>
        </div>

        <p>
            <button class="pure-button pure-button-primary pure-button-small"
                    data-ng-disabled="txForm.okButtonDisabled()"
                    data-ng-click="txForm.save()">
                Save
            </button>
            <button class="pure-button pure-button-primary pure-button-small"
                    data-ng-disabled="txForm.resetButtonDisabled()"
                    data-ng-click="txForm.cancel()">
                Cancel
            </button>
        </p>
    </div>
    <div data-ng-if="!txForm.isOpen()">
        <p>
            <button class="pure-button pure-button-primary" data-ng-click="txEdit.open()">
                Edit
            </button>
        </p>
    </div>
</div>